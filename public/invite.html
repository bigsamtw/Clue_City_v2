<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Clue City</title>
  <link rel="stylesheet" type="text/css" href="styles/InviteStyle.css">
  <link rel="stylesheet" type="text/css" href="semantic/out/semantic.min.css">
  <!-- TODO add manifest here -->
  <link rel="manifest" href="/manifest.json">
  <!-- Add to home screen for Safari on iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="#FFFFFF">
  <meta name="apple-mobile-web-app-title" content="Clue City">
  <link rel="apple-touch-icon" href="images/logo.png">
  <meta name="msapplication-TileImage" content="images/icons/icon-144x144.png">
  <meta name="msapplication-TileColor" content="#2F3BA2">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"
       integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
       crossorigin="anonymous">
    </script>
</head>
    <script>
    $(document).ready(function(){
       $(".Invite").click(function(){
           this.src="images/Team/invited.png";
       });
        $(".TeamName").hide();
        $("#VagueBack").hide();
        $("#X").click(function(){
            $(".TeamName").fadeOut();
            $("#VagueBack").fadeOut();
        });
        $("#Shihan").click(function(){
          $("#FriendHead5").attr("src","images/Team/HsiHan.jpg");
        });
    });
    </script>
<body>
        <script>

                window.fbAsyncInit = function() {
                    FB.init({
                      appId      : '177842309598524',
                      cookie     : true,
                      xfbml      : true,
                      version    : 'v3.0'
                    });
                      
                    FB.getLoginStatus(function(response) {
                    statusChangeCallback(response);
                  });               
                };
                
                  (function(d, s, id){
                     var js, fjs = d.getElementsByTagName(s)[0];
                     if (d.getElementById(id)) {return;}
                     js = d.createElement(s); js.id = id;
                     js.src = "https://connect.facebook.net/en_US/sdk.js";
                     fjs.parentNode.insertBefore(js, fjs);
                   }(document, 'script', 'facebook-jssdk'));
              
              
                
               function statusChangeCallback(response){
                 if( response.status === 'connected' ){
                   console.log( 'Logged in and authenticated' );
                   getProfile();
                   friends();
                   getteamname();
                 } else {
                  console.log( 'Not authenticated' );
                 }
               }
              
            
              function checkLoginState() {
                FB.getLoginStatus(function(response) {
                  statusChangeCallback(response);
                });
              }
              
              var responseData  ;
      
              function getProfile(){
                FB.api('/me?fields=name,email',function(response){
                  if(response && !response.error){
                    responseData = response ;
                  }
                })
              }

              var teamname ;

              function getteamname(){
                $.ajax({
                  type : 'post',
                  url : './invite/get_teamname',
                  data:{},
                  success : function(data){
                    teamname = data ;
                    console.log(teamname);
                  }
                });
              }

              var choose_friend;

              function friends(){
                $.ajax({
                  type : 'post',
                  url : './invite/friend',
                  data : {},
                  success : function(data){
                    choose_friend = data ;
                    let url ;
                    for(let i = 0; i < data.length ; i++){
                      url = `https://graph.facebook.com/${data[i].id}/picture?type-normal`;
                      getPicture(url,(i+1));
                      getName( data[i].name,(i+1));
                    }
                  }
                })
              }

              function Friends(number){
                let sendto = { "id": number.id };
                invite(sendto);
              }

              function getPicture(url,num){
                $(`#bighead${num}`).attr("src",url);
              }
              function getName(getname,num){
                $(`#name${num}`).text(getname);
              }

              function invite(sendto){
                let sender =  responseData ;
                let inviteto = sendto.id ;
                $.ajax ({
                  type : 'post',
                  url : './invite/invite',
                  data : {
                      sender : sender.id,
                      to : inviteto,
                      name : teamname,
                  }
                });
              }

              function starting(){
            
                $.ajax ({
                  type : 'post',
                  url : './invite/tellteam',
                  data : {name:teamname}
                });
                gogaming();
              }

              var waitsignal = setInterval(checkresponse , 1000);
              var be_invited = 0;
              var invite_info = 0;
              var answer ;
              var num = 0;

              function checkresponse(){ 
                  $.ajax ({
                    type : 'post',
                    url : './invite/checkresponse',
                    data : { sender : responseData.id},
                    success : function(data){
                      if( data == "" || data==null){}
                      else{
                        invite_info = data ;
                        if( invite_info.accepted == "1" ){
                          console.log("agree join");
                          num++;
                          if(num == 1){
                            join1( invite_info.to);
                          }
                          else if(num ==2){
                            join2( invite_info.to);
                          }
                          else if(num ==3){
                            join3( invite_info.to);
                          }
                          else if(num ==4){
                            join4( invite_info.to);
                          }
                          else if(num ==5){
                            join5( invite_info.to);
                          }
                          else if(num ==6){
                            join6( invite_info.to);
                          }
                          else if(num ==7){
                            join7( invite_info.to);
                          }
                        }
                        else{
                          console.log("reject join");
                        }
                      }
                    }
                });
              }
            
            function join1(teammate){
              $.ajax({
                method : 'post',
                url : './invite/teammate',
                data : {
                  teammate1 : teammate,
                },
              });
              console.log("join1");
            } 
            function join2(teammate){
              $.ajax({
                method : 'post',
                url : './invite/teammate',
                data : {
                  teammate2 : teammate,
                },
              });
              console.log("join2");
            } 
            function join3(teammate){
              $.ajax({
                method : 'post',
                url : './invite/teammate',
                data : {
                  teammate3 : teammate,
                },
              });
              console.log("join3");
            } 
            function join4(teammate){
              $.ajax({
                method : 'post',
                url : './invite/teammate',
                data : {
                  teammate4 : teammate,
                },
              });
              console.log("join4");
            } 
            function join5(teammate){
              $.ajax({
                method : 'post',
                url : './invite/teammate',
                data : {
                  teammate5 : teammate,
                },
              });
              console.log("join5");
            } 
            function join6(teammate){
              $.ajax({
                method : 'post',
                url : './invite/teammate',
                data : {
                  teammate6 : teammate,
                },
              });
              console.log("join6");
            } 
            function join7(teammate){
              $.ajax({
                method : 'post',
                url : './invite/teammate',
                data : {
                  teammate7 : teammate,
                },
              });
              console.log("join7");
            } 

            function gogaming(){
                document.location.href="https://luffy.ee.ncku.edu.tw:10047/map";
            }
            function gotoinvite(){
              document.location.href="https://luffy.ee.ncku.edu.tw:10047/invite"; 
            }
            function gotosetting(){
              document.location.href="https://luffy.ee.ncku.edu.tw:10047/setting"; 
            }
            function gotohome(){
                document.location.href="https://luffy.ee.ncku.edu.tw:10047/menu";
            }
            function gotogallery(){
                document.location.href="https://luffy.ee.ncku.edu.tw:10047/gallery";
            }
            function gotofriend(){
                document.location.href="https://luffy.ee.ncku.edu.tw:10047/friend.html";
            }
            function gotoScore(){
                document.location.href="https://luffy.ee.ncku.edu.tw:10047/score";
            }
          </script>
    <img src="images/Team/Background.png" id="TeamBackground">
    <div id="VagueBack"></div>
    <div class="team">
        <div class="topbar">
            <img src="images/Team/WhiteBack.png" id="WhiteBack" onclick="gobackmode()">
            <img src="images/Team/adhoc mode.png" class="TopBarMid" id="AdhocMode">
            <img src="images/Team/wheel.png" class="TopBarWheel" id="Wheel" onclick="gotosetting()">
        </div>
        <div class="FriendsIn">
            <img src="images/Team/Blankhead.png" class="FriendHead" id="FriendHead1">
            <img src="images/Team/Blankhead.png" class="FriendHead" id="FriendHead2">
            <img src="images/Team/Blankhead.png" class="FriendHead" id="FriendHead3">
            <img src="images/Team/lisa.jpg"      class="FriendHead" id="FriendHead4">
            <img src="images/Team/Blankhead.png" class="FriendHead" id="FriendHead5">
            <img src="images/Team/Blankhead.png" class="FriendHead" id="FriendHead6">
            <img src="images/Team/Blankhead.png" class="FriendHead" id="FriendHead7">
            <img src="images/Team/Blankhead.png" class="FriendHead" id="FriendHead8">
        </div>
        <div class="FriendsOnline">
            <p id="Friendonline">MY FRIENDS</p>
            <div id="OnlineList">
                <p class="Online" id="FriendNum">好友在線(</p>
                <p class="Online" id="OnlineNum">12</p>
                <p class="Online" id="Dash">/</p>
                <p class="Online" id="TotalNum">125</p>
                <p class="Online" id="RightQuat">)</p>
            </div>
            <img src="images/Team/Plus.png" id="Plus" onclick="gotoaddfriend()">
        </div>
        <div class="FriendList">
            <div class="ui middle aligned selection list">
                <div class="item">
                    <img class="OnlineDot"  src="images/Team/greendot.png">
                    <img class="ui avatar image" id = "bighead1" >
                    <div class="content">
                        <div class="header" id="name1"></div>
                    </div>
                    <img class="Invite" src="images/Team/invite.png"  onclick = "Friends(choose_friend[0])">
                </div>
                <div class="item">
                    <img class="OnlineDot"  src="images/Team/graydot.png">
                    <img class="ui avatar image"id = "bighead2" src="images/Team/Wang.jpg">
                    <div class="content">
                        <div class="header"id="name2"></div>
                    </div>
                    <img class="Invite" src="images/Team/invite.png" onclick = "Friends(choose_friend[1])">
                </div>
                <div class="item">
                    <img class="OnlineDot" src="images/Team/greendot.png">
                    <img class="ui avatar image" id = "bighead3"src="images/Team/HsiHan.jpg">
                    <div class="content">
                        <div class="header"id="name3"></div>
                    </div>
                    <img class="Invite" src="images/Team/invite.png" onclick = "Friends(choose_friend[2])">
                </div>
                <div class="item">
                    <img class="OnlineDot" src="images/Team/graydot.png">
                    <img class="ui avatar image" id = "bighead4"src="images/Team/Chia.jpg">
                    <div class="content">
                        <div class="header"id="name4"></div>
                    </div>
                    <img class="Invite" src="images/Team/invite.png"  onclick = "Friends(choose_friend[3])">
                </div>
                <div class="item">
                    <img class="OnlineDot"  src="images/Team/greendot.png">
                    <img class="ui avatar image" id = "bighead5"src="images/Team/Andy.jpg">
                    <div class="content">
                        <div class="header"id="name5"></div>
                    </div>
                    <img class="Invite" src="images/Team/invite.png" onclick = "Friends(choose_friend[4])">
                </div>
                <div class="item">
                    <img class="OnlineDot"  src="images/Team/greendot.png">
                    <img class="ui avatar image" id = "bighead6"src="images/Team/Lewis.jpg">
                    <div class="content">
                        <div class="header"id="name6"></div>
                    </div>
                    <img class="Invite" src="images/Team/invite.png" onclick = "Friends(choose_friend[5])">
                </div>
                <div class="item">
                    <img class="OnlineDot" src="images/Team/greendot.png">
                    <img class="ui avatar image" src="images/Team/HsiHan.jpg">
                    <div class="content">
                        <div class="header">Han Chen</div>
                    </div>
                    <img class="Invite" src="images/Team/invite.png">
                </div>
                <div class="item">
                    <img class="OnlineDot" src="images/Team/greendot.png">
                    <img class="ui avatar image" src="images/Team/HsiHan.jpg">
                    <div class="content">
                        <div class="header">Han Chen</div>
                    </div>
                    <img class="Invite" src="images/Team/invite.png">
                </div>
                <div class="item">
                    <img class="OnlineDot" src="">
                    <img class="ui avatar image" src="images/Team/HsiHan.jpg">
                    <div class="content">
                        <div class="header"></div>
                    </div>
                    <img class="Invite" src="">
                </div>
            </div>
        </div>
        <div id="StartGame">
            <img src="images/Team/StartTheGame.png" id="StartGameIcon" onclick = "starting()">
        </div>
        <div id="Bottom">
                <img src="images/Mode/home icon.png" class="BottomIcon" id="HomeIcon" onclick="gotohome()">
                <img src="images/Mode/gallery icon.png" class="BottomIcon" id="GalleryIcon"  onclick="gotogallery()">
                <img src="images/Mode/group icon.png" class="BottomIcon" id="GroupIcon" >
                <img src="images/Mode/leaderboard icon.png" class="BottomIcon" id="RankIcon" onclick="gotoScore()">
        </div>
    </div>
    
</body>
